<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Monitoring - Malpractice Detection</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-danger">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-video me-2"></i>
                Live Monitoring Session
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">
                    <i class="fas fa-circle text-success blink"></i>
                    RECORDING
                </span>
                <button type="button" class="btn btn-outline-light" onclick="stopMonitoring()">
                    <i class="fas fa-stop me-2"></i>Stop Session
                </button>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-3">
        <div class="row">
            <!-- Video Feed Section -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-camera me-2"></i>Live Video Feed</h5>
                    </div>
                    <div class="card-body p-2">
                        <div class="video-container">
                            <img src="{{ url_for('video_feed') }}" class="img-fluid video-stream" alt="Live Video Feed">
                            <div class="video-overlay">
                                <div class="timestamp" id="currentTime"></div>
                                <div class="status-indicator">
                                    <i class="fas fa-eye text-success"></i>
                                    AI MONITORING ACTIVE
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Real-time Statistics -->
                <div class="card mt-3">
                    <div class="card-header bg-info text-white">
                        <h6 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Real-time Detection Statistics</h6>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-4">
                                <div class="stat-card stat-hand-gestures">
                                    <i class="fas fa-hand-paper fa-2x mb-2"></i>
                                    <h4 id="handGestureCount">0</h4>
                                    <p class="mb-0">Hand Gestures</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stat-card stat-mobile">
                                    <i class="fas fa-mobile-alt fa-2x mb-2"></i>
                                    <h4 id="mobilePhoneCount">0</h4>
                                    <p class="mb-0">Mobile Phone</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stat-card stat-talking">
                                    <i class="fas fa-comments fa-2x mb-2"></i>
                                    <h4 id="talkingCount">0</h4>
                                    <p class="mb-0">Talking</p>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12 text-center">
                                <div class="stat-card stat-total">
                                    <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
                                    <h3 id="totalEvents">0</h3>
                                    <p class="mb-0">Total Events Detected</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Alerts and Logs Section -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-bell me-2"></i>Live Alerts</h5>
                    </div>
                    <div class="card-body p-0">
                        <div id="alertsContainer" class="alerts-container">
                            <div class="alert alert-info m-2">
                                <i class="fas fa-info-circle me-2"></i>
                                Monitoring session started. Waiting for detections...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Session Information -->
                <div class="card mt-3">
                    <div class="card-header bg-secondary text-white">
                        <h6 class="mb-0"><i class="fas fa-clock me-2"></i>Session Information</h6>
                    </div>
                    <div class="card-body">
                        <div class="session-info">
                            <p><strong>Start Time:</strong> <span id="sessionStart">--</span></p>
                            <p><strong>Duration:</strong> <span id="sessionDuration">00:00:00</span></p>
                            <p><strong>Detection Rate:</strong> <span id="detectionRate">0.0/min</span></p>
                            <p class="mb-0"><strong>Status:</strong> 
                                <span class="badge bg-success">
                                    <i class="fas fa-circle me-1"></i>Active
                                </span>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card mt-3">
                    <div class="card-header bg-dark text-white">
                        <h6 class="mb-0"><i class="fas fa-tools me-2"></i>Quick Actions</h6>
                    </div>
                    <div class="card-body">
                        <button type="button" class="btn btn-outline-primary btn-sm w-100 mb-2" onclick="refreshAlerts()">
                            <i class="fas fa-sync me-2"></i>Refresh Alerts
                        </button>
                        <button type="button" class="btn btn-outline-success btn-sm w-100 mb-2" onclick="exportCurrentSession()">
                            <i class="fas fa-download me-2"></i>Export Session
                        </button>
                        <button type="button" class="btn btn-outline-danger btn-sm w-100" onclick="stopMonitoring()">
                            <i class="fas fa-stop me-2"></i>Stop & Generate Report
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stop Monitoring Modal -->
    <div class="modal fade" id="stopModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-stop me-2"></i>Stop Monitoring Session
                    </h5>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to stop the current monitoring session?</p>
                    <p class="text-muted">This will end the session and redirect you to the summary page with all detected events.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <form action="/stop_monitoring" method="POST" style="display: inline;">
                        <button type="submit" class="btn btn-danger">
                            <i class="fas fa-stop me-2"></i>Stop Session
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/monitoring.js') }}"></script>
</body>
</html>
